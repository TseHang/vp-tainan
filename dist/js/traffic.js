<<<<<<< HEAD
"use strict";function addEventCircle(i,t){var a=i.lat,e=i.lng,r=i.daynight,n=i.date,o=i.hour,c=i.rush;if(void 0!==a||void 0!==e)if("day"===r)if(c){var s="circle day rush "+o,l=L.circle([a,e],{color:"#ff6f69",stroke:!1,fillColor:"#ff6f69",fillOpacity:.8,radius:20,className:s}).addTo(t);l.bindPopup("時間： "+n.toString())}else{var d="circle day nonrush "+o,g=L.circle([a,e],{color:"#ff6f69",stroke:!1,fillColor:"#ff6f69",fillOpacity:.8,radius:20,className:d}).addTo(t);g.bindPopup("時間： "+n.toString())}else if(c){var h="circle night rush "+o,u=L.circle([a,e],{color:"#265665",stroke:!1,fillColor:"#265665",fillOpacity:.6,radius:20,className:h}).addTo(t);u.bindPopup("時間： "+n.toString())}else{var f="circle night nonrush "+o,p=L.circle([a,e],{color:"#265665",stroke:!1,fillColor:"#265665",fillOpacity:.6,radius:20,className:f}).addTo(t);p.bindPopup("時間： "+n.toString())}}function addWarningArea(i,t){var a=i.lat,e=i.lng;L.circle([a,e],{color:"#FFCC00",stroke:!1,fillColor:"#FFCC00",fillOpacity:.8,radius:100,className:"warningArea"}).addTo(t).bindPopup("常發生事故路段: 累積事件數："+i.count)}function brushed(){if(d3.event.sourceEvent&&d3.event.selection){var i=d3.event.selection.map(x.invert),t=i.map(function(i){return+parseInt(i)});t[0]>=t[1]&&(t[0]=i[0],t[1]=i[0]+1),d3.select(this).transition().call(d3.event.target.move,t.map(x)),$("#night_toggle").removeAttr("checked"),$("#day_toggle").removeAttr("checked"),$(".day").css("visibility","hidden"),$(".night").css("visibility","hidden");for(var a=t[0];a<=t[1];a++){var e=".hour"+a;$(e).css("visibility","visible")}}}var mymap=L.map("accidentMap").setView([22.9945,120.21208],14);L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{maxZoom:18,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'}).addTo(mymap),isMobile&&$(".hint").css("display","none");var legend=L.control({position:"bottomright"});legend.onAdd=function(){for(var i=L.DomUtil.create("div","info legend"),t=["#ff6f69","#265665"],a=["白天(5:00-17:00)","晚上(17:00-5:00)"],e=0;e<a.length;e++)i.innerHTML+='<p><i style="background:'+t[e]+'"></i> '+a[e]+"<br></p>";return i},legend.addTo(mymap),$("#day_toggle").on("click",function(){$("#day_toggle").is(":checked")?$(".day").css("visibility","visible"):$(".day").css("visibility","hidden")}),$("#night_toggle").on("click",function(){$("#night_toggle").is(":checked")?$(".night").css("visibility","visible"):$(".night").css("visibility","hidden")}),$("#warning_area_checkbox").on("click",function(){$("#warning_area_checkbox").is(":checked")?$(".warningArea").css("visibility","visible"):$(".warningArea").css("visibility","hidden")}),$.getJSON("./src/data/trafficeRawData.json",function(i){$.each(i,function(i,t){addEventCircle(t,mymap)})}),$.getJSON("./src/data/trafficWarningArea.json",function(i){$.each(i,function(i,t){addWarningArea(t,mymap)})});var svg=d3.select("#linechart svg"),margin={top:20,right:20,bottom:30,left:50},width=$("#linechart").width()-10,height=+svg.attr("height")-margin.bottom,g=svg.append("g").attr("transform","translate(0,5)"),x=d3.scaleLinear().rangeRound([0,width]),y=d3.scaleLinear().rangeRound([height,0]),brush=d3.brushX().extent([[0,0],[width,height]]).on("brush end",brushed),area=d3.area().x(function(i){return x(i.hour)}).y1(function(i){return y(i.count)});d3.csv("./src/data/trafficHourSummary.csv",function(i){return i.hour=i.hour,i.count=+i.count,i},function(i,t){if(i)throw i;x.domain([0,23]),y.domain([0,d3.max(t,function(i){return i.count+30})]),area.y0(y(0)),g.append("path").datum(t).attr("fill","grey").attr("opacity","0.4").attr("d",area),g.append("g").attr("class","axis").attr("transform","translate(2,"+height+")").call(d3.axisBottom(x).ticks(24)),g.append("g").attr("class","brush").call(brush).call(brush.move,x.range())});
=======
"use strict";function addEventCircle(t,e){var a=t.lat,i=t.lng,n=t.daynight,r=t.date;if(void 0!==a||void 0!==i)if("day"===n){var l=L.circle([a,i],{color:"#ff6f69",stroke:!1,fillColor:"#ff6f69",fillOpacity:.5,radius:15,className:"circle day"}).addTo(e);l.bindPopup("時間： "+r.toString())}else{var o=L.circle([a,i],{color:"#265665",stroke:!1,fillColor:"#265665",fillOpacity:.5,radius:15,className:"circle night"}).addTo(e);o.bindPopup("時間： "+r.toString())}}var mymap=L.map("accidentMap").setView([22.9945,120.21208],14);L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{maxZoom:18,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'}).addTo(mymap);var legend=L.control({position:"bottomright"});legend.onAdd=function(){for(var t=L.DomUtil.create("div","info legend"),e=["#ff6f69","#265665"],a=["白天(5:00-17:00)","晚上(17:00-5:00)"],i=0;i<a.length;i++)t.innerHTML+='<p><i style="background:'+e[i]+'"></i> '+a[i]+"<br></p>";return t},legend.addTo(mymap),$("#day_toggle").on("click",function(){$("#day_toggle").is(":checked")?$(".day").css("visibility","visible"):$(".day").css("visibility","hidden")}),$("#night_toggle").on("click",function(){$("#night_toggle").is(":checked")?$(".night").css("visibility","visible"):$(".night").css("visibility","hidden")}),$.getJSON("./src/data/trafficeRawData.json",function(t){$.each(t,function(t,e){addEventCircle(e,mymap)})}),function(t){var e=Math.min(300,300)/2,a=t.select("#pieChart").append("svg").attr("width",600).attr("height",310).append("g").attr("transform","translate(150,150)"),i=t.svg.arc().innerRadius(e-25).outerRadius(e);a.append("g").append("circle").attr("cx",0).attr("cy",0).attr("r",112.5).attr("fill","none").attr("stroke","#BEBEBE").attr("stroke-width",3);var n=t.layout.pie().value(function(t){return t.times}).sort(null),r=t.select("#pieChart").append("div").attr("class","tooltip");r.append("div").attr("class","event"),r.append("div").attr("class","times"),r.append("div").attr("class","percent"),t.csv("./src/data/trafficExposedData.csv",function(e,l){var o=t.scale.category20c();l.forEach(function(t){t.times=+t.times});var s=a.selectAll("path").data(n(l)).enter().append("path").attr("d",i).attr("fill",function(t,e){return o(t.data.event)});s.on("mouseover",function(e){var a=t.sum(l.map(function(t){return t.times})),i=Math.round(1e3*e.data.times/a)/10,n=t.format(",");r.select(".event").html('<h1 class="tooltip-title">'+e.data.event+'</h1><div class="title-line"></div>'),r.select(".times").html(n(e.data.times)+" 件"),r.select(".percent").html(i+"%"),r.style("display","block")}),s.on("mouseout",function(){r.style("display","none")});var c=a.selectAll(".legend").data(o.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(200,"+(22*e-22*o.domain().length/2+10)+")"});c.append("rect").attr("width",18).attr("height",18).style("fill",o).style("stroke",o),c.append("text").attr("x",22).attr("y",14).text(function(t){return t})})}(window.d3);
>>>>>>> de683aab788ced54178e9ff54eedcb3011850e8f
