"use strict";function addEventCircle(t,e){var a=t.lat,n=t.lng,i=t.daynight,r=t.date;if(void 0!==a||void 0!==n)if("day"===i){var s=L.circle([a,n],{color:"#ff6f69",stroke:!1,fillColor:"#ff6f69",fillOpacity:.5,radius:15,className:"circle day"}).addTo(e);s.bindPopup("時間： "+r.toString())}else{var l=L.circle([a,n],{color:"#265665",stroke:!1,fillColor:"#265665",fillOpacity:.5,radius:15,className:"circle night"}).addTo(e);l.bindPopup("時間： "+r.toString())}}var mymap=L.map("accidentMap").setView([22.9945,120.21208],14);L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{maxZoom:18,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'}).addTo(mymap);var legend=L.control({position:"bottomright"});legend.onAdd=function(){for(var t=L.DomUtil.create("div","info legend"),e=["#ff6f69","#265665"],a=["白天(5:00-17:00)","晚上(17:00-5:00)"],n=0;n<a.length;n++)t.innerHTML+='<p><i style="background:'+e[n]+'"></i> '+a[n]+"<br></p>";return t},legend.addTo(mymap),$("#day_toggle").on("click",function(){$("#day_toggle").is(":checked")?$(".day").css("visibility","visible"):$(".day").css("visibility","hidden")}),$("#night_toggle").on("click",function(){$("#night_toggle").is(":checked")?$(".night").css("visibility","visible"):$(".night").css("visibility","hidden")}),$.getJSON("./src/data/trafficeRawData.json",function(t){$.each(t,function(t,e){addEventCircle(e,mymap)})}),function(t){var e=t.select("#pieChart").append("svg").attr("width","100%").attr("height",420),a=t.svg.arc().innerRadius(125).outerRadius(150),n=e.append("g").attr("id","pieSvg").attr("class","pie-svg").attr("transform","translate("+$("svg").width()/2+",210)");n.append("g").append("circle").attr("cx",0).attr("cy",0).attr("r",112.5).attr("fill","none").attr("stroke","#BEBEBE").attr("stroke-width",3),n.append("g").attr("class","lines");var i=t.layout.pie().value(function(t){return t.times}).sort(null),r=t.select("#pieChart").append("div").attr("class","tooltip");r.append("div").attr("class","event"),r.append("div").attr("class","times"),r.append("div").attr("class","percent"),t.csv("./src/data/trafficExposedData.csv",function(s,l){function c(t){return t.startAngle+(t.endAngle-t.startAngle)/2}var o=[];l.forEach(function(t){o.push(t.event)});var d=t.scale.ordinal().domain(o).range(["#4F9D9D","#95CACA","#5A5AAD","#A6A6D2","#C07AB8","#FFAD86","#FF95CA","#00E3E3","#009393","#46A3FF","#66CDAA","#8600FF","#CA8EFF","#FFB5B5"]);l.forEach(function(t){t.times=+t.times});var p=n.selectAll("path").data(i(l)).enter().append("path").attr("d",a).attr("fill",function(t,e){return d(t.data.event)});r.select(".event").html('<h1 class="tooltip-title">舉發總件數</h1><div class="title-line"></div>'),r.select(".times").html("370,040 件");var u=t.sum(l.map(function(t){return t.times}));p.on("mouseover",function(e){var a=Math.round(1e3*e.data.times/u)/10,n=t.format(",");r.select(".event").html('<h1 class="tooltip-title">'+e.data.event+'</h1><div class="title-line"></div>'),r.select(".times").html(n(e.data.times)+" 件"),r.select(".percent").html(a+"%")}),p.on("mouseout",function(){r.select(".event").html('<h1 class="tooltip-title">舉發總件數</h1><div class="title-line"></div>'),r.select(".times").html("370,040 件"),r.select(".percent").html("")});var f=n.append("g").attr("transform","translate(0,0)"),h=t.svg.arc().innerRadius(120).outerRadius(160),v=t.svg.arc().innerRadius(190).outerRadius(190);f.selectAll("text").data(i(l)).enter().append("text").attr("class","label-style").attr("fill","#3C3C3C").attr("transform",function(t){var e=v.centroid(t);return e[0]=200*(c(t)<Math.PI?1:-1),"translate("+e+")"}).attr("text-anchor",function(t){return-1==(c(t)<Math.PI?1:-1)?"end":"start"}).text(function(e){var a=t.sum(l.map(function(t){return t.times})),n=Math.round(1e3*e.data.times/a)/10;return e.data.event+" "+n+"%"});var m=(f.selectAll("polyline").data(i(l),function(t){return t.data.event}).enter().append("polyline").attr("points",function(t){var e=v.centroid(t);return e[0]=190*(c(t)<Math.PI?1:-1),[h.centroid(t),v.centroid(t),e]}),l.sort(function(t,e){return e.times-t.times})),g=e.append("g").attr("id","legendSvg").attr("class","legend-svg").attr("transform","translate("+($("svg").width()/2-170)+",180)").selectAll(".legend-style").data(m).enter().append("g").attr("class","legend-style").attr("transform",function(t,e){return"translate(0,"+(26*e-26*m.length/2+10)+")"});g.append("rect").attr("width",18).attr("height",18).style("fill",function(t){return d(t.event)}).style("stroke",function(t){return d(t.event)}),g.append("text").attr("x",28).attr("y",14).text(function(t){var e=Math.round(1e3*t.times/u)/10;return t.event+" "+e+"%"})})}(window.d3);var vm=new Vue({el:"#fineCreator",data:{eventData:[],setList:[],idEventData:{},selectId:[],selectName:[],fineList:[],fineTotal:0,fineData:[]},delimiters:["${","}"],created:function(){jQuery.get("/src/data/trafficFineSelect.json",function(t){vm.eventData=t,$.each(vm.eventData,function(t,e){vm.idEventData[e.id]=e.category})}),jQuery.get("/src/data/trafficFineChart.json",function(t){vm.fineData=t})},methods:{addSetting:function(t){this.setList.push(this.idEventData[t]);var e=[],a=[];$.each(this.idEventData[t],function(t,n){e.push({x:n.category[0].name}),a.push(n.category[0].id)}),this.selectName.push(e),this.selectId.push(a),this.addFine(a,-1)},changeSelectId:function(t,e,a){this.selectId[t][e]=a,this.addFine(this.selectId[t],t)},addFine:function(t,e){$.each(this.fineData,function(a,n){if(0===$(n.all_id).not(t).get().length)return-1===e?vm.fineList.push(n.fine):vm.fineList[e]=n.fine,!1})},removeItem:function(t){this.fineList.splice(t,1),this.selectId.splice(t,1),this.selectName.splice(t,1),this.setList.splice(t,1)}}});