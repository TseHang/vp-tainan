"use strict";function addEventCircle(t,e){var a=t.lat,i=t.lng,n=t.daynight,s=t.date;if(void 0!==a||void 0!==i)if("day"===n){var r=L.circle([a,i],{color:"#ff6f69",stroke:!1,fillColor:"#ff6f69",fillOpacity:.5,radius:15,className:"circle day"}).addTo(e);r.bindPopup("時間： "+s.toString())}else{var c=L.circle([a,i],{color:"#265665",stroke:!1,fillColor:"#265665",fillOpacity:.5,radius:15,className:"circle night"}).addTo(e);c.bindPopup("時間： "+s.toString())}}var mymap=L.map("accidentMap").setView([22.9945,120.21208],14);L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{maxZoom:18,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'}).addTo(mymap);var legend=L.control({position:"bottomright"});legend.onAdd=function(){for(var t=L.DomUtil.create("div","info legend"),e=["#ff6f69","#265665"],a=["白天(5:00-17:00)","晚上(17:00-5:00)"],i=0;i<a.length;i++)t.innerHTML+='<p><i style="background:'+e[i]+'"></i> '+a[i]+"<br></p>";return t},legend.addTo(mymap),$("#day_toggle").on("click",function(){$("#day_toggle").is(":checked")?$(".day").css("visibility","visible"):$(".day").css("visibility","hidden")}),$("#night_toggle").on("click",function(){$("#night_toggle").is(":checked")?$(".night").css("visibility","visible"):$(".night").css("visibility","hidden")}),$.getJSON("./src/data/trafficeRawData.json",function(t){$.each(t,function(t,e){addEventCircle(e,mymap)})}),function(t){var e=Math.min(300,300)/2,a=t.select("#pieChart").append("svg").attr("width",600).attr("height",310).append("g").attr("transform","translate(150,150)"),i=t.svg.arc().innerRadius(e-25).outerRadius(e);a.append("g").append("circle").attr("cx",0).attr("cy",0).attr("r",112.5).attr("fill","none").attr("stroke","#BEBEBE").attr("stroke-width",3);var n=t.layout.pie().value(function(t){return t.times}).sort(null),s=t.select("#pieChart").append("div").attr("class","tooltip");s.append("div").attr("class","event"),s.append("div").attr("class","times"),s.append("div").attr("class","percent"),t.csv("./src/data/trafficExposedData.csv",function(e,r){var c=t.scale.category20c();r.forEach(function(t){t.times=+t.times});var l=a.selectAll("path").data(n(r)).enter().append("path").attr("d",i).attr("fill",function(t,e){return c(t.data.event)});l.on("mouseover",function(e){var a=t.sum(r.map(function(t){return t.times})),i=Math.round(1e3*e.data.times/a)/10,n=t.format(",");s.select(".event").html('<h1 class="tooltip-title">'+e.data.event+'</h1><div class="title-line"></div>'),s.select(".times").html(n(e.data.times)+" 件"),s.select(".percent").html(i+"%"),s.style("display","block")}),l.on("mouseout",function(){s.style("display","none")});var o=a.selectAll(".legend").data(c.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(200,"+(22*e-22*c.domain().length/2+10)+")"});o.append("rect").attr("width",18).attr("height",18).style("fill",c).style("stroke",c),o.append("text").attr("x",22).attr("y",14).text(function(t){return t})})}(window.d3);var vm=new Vue({el:"#fineCreator",data:{eventData:[],setList:[],idEventData:{},selectId:[],selectName:[],fineList:[],fineTotal:0,fineData:[]},delimiters:["${","}"],created:function(){jQuery.get("/src/data/trafficFineSelect.json",function(t){vm.eventData=t,$.each(vm.eventData,function(t,e){vm.idEventData[e.id]=e.category})}),jQuery.get("/src/data/trafficFineChart.json",function(t){vm.fineData=t})},methods:{addSetting:function(t){this.setList.push(this.idEventData[t]);var e=[],a=[];$.each(this.idEventData[t],function(t,i){e.push({x:i.category[0].name}),a.push(i.category[0].id)}),this.selectName.push(e),this.selectId.push(a),this.addFine(a,-1)},changeSelectId:function(t,e,a){this.selectId[t][e]=a,this.addFine(this.selectId[t],t)},addFine:function(t,e){$.each(this.fineData,function(a,i){if(0===$(i.all_id).not(t).get().length)return-1===e?vm.fineList.push(i.fine):vm.fineList[e]=i.fine,!1})},removeItem:function(t){this.fineList.splice(t,1),this.selectId.splice(t,1),this.selectName.splice(t,1),this.setList.splice(t,1)}}});