"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var d3=window.d3,Vue=window.Vue,$=window.$;!function(t){var e=void 0,a=void 0,r=d3.scale.linear().domain([860,13e3]).range(["#ffb62a","#503604"]),n=d3.select(".area-desktop-map").append("svg").attr("width","100%").attr("height",$(".area-intro").height()),o=d3.select(".area-mobile-map").append("svg").attr("width","100%").attr("height",.35*$(t).height()),i=$(t).width()<768,s={},l={high:1e4,middle:1e3,little:860},c=function(t){return t>=l.high?"極高":t>=l.middle?"高":t>=l.little?"介於平均值附近":"低於平均值"};i&&$("#tainan-every-area").addClass("color-red p-size-big"),d3.csv("./src/data/population_xyz.csv",function(a){function r(t,e){var a=e?t.naturalData:t.socialData;c.selectAll(".population-name-text").data(a).transition().duration(100).text(function(t,e){return 0===e?$("#top-bar").text(t.name):1===e&&$("#bottom-bar").text(t.name),t.name}),c.selectAll("rect").data(a).transition().duration(1e3).attr("width",function(t){return A(t.value)}),c.selectAll(".num-text").data(a).transition().duration(1e3).tween("num-text",function(t,e){var a=d3.interpolateRound(F[e],t.value);return F[e]=t.value,F[0]-F[1]<0?$("#support-diff").addClass("color-red"):$("#support-diff").removeClass("color-red"),$("#support-diff").text(F[0]-F[1]+" 人"),function(t){var e=a(t);this.setAttribute("x",A(e)+15),this.textContent=e+" 人"}})}var n=(new Vue({delimiters:["${","}"],el:"#table-list",data:{dataArray:a},computed:{descendSexratio:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.sexRatio)-parseFloat(t.sexRatio)}),[t[29]].concat(_toConsumableArray(t))},descendRaiseratio:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.raiseRatio)-parseFloat(t.raiseRatio)}),[t[26]].concat(_toConsumableArray(t))},descendZeroFourteen:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.zero_fourteen_percent)-parseFloat(t.zero_fourteen_percent)}),[t[10]].concat(_toConsumableArray(t))},descendFifteenSixtyfour:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.fifteen_sixtyFour_percent)-parseFloat(t.fifteen_sixtyFour_percent)}),[t[10]].concat(_toConsumableArray(t))},descendSixtyFive:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.sixtyFiveUp_percent)-parseFloat(t.sixtyFiveUp_percent)}),[t[28]].concat(_toConsumableArray(t))},descendBorn:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.born_num.replace(/,/gi,""))-parseFloat(t.born_num.replace(/,/gi,""))})},descendDeath:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.death_num.replace(/,/gi,""))-parseFloat(t.death_num.replace(/,/gi,""))})},descendImmigration:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.immigration_num.replace(/,/gi,""))-parseFloat(t.immigration_num.replace(/,/gi,""))})},descendLeaving:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.leaving_num.replace(/,/gi,""))-parseFloat(t.leaving_num.replace(/,/gi,""))})},descendNatural:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.naturalIncrease_percent)-parseFloat(t.naturalIncrease_percent)}),[t[9]].concat(_toConsumableArray(t))},descendSociety:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.society_percent)-parseFloat(t.society_percent)}),[t[13]].concat(_toConsumableArray(t))},descendPopulationChange:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.population_change_percent)-parseFloat(t.population_change_percent)}),[t[9]].concat(_toConsumableArray(t))}}}),{sexRatioSvg:{width:i?"100%":"80%",height:i?80:40},agesPramidSvg:{width:"100%",height:300,rectY:20,blocks:15.8},populationChangeSvg:{width:"100%",height:110}}),o=d3.select(".sexRatioSvg").append("svg").attr("width",n.sexRatioSvg.width).attr("height",n.sexRatioSvg.height),l=d3.select(".agesPramidSvg").append("svg").attr("width",n.agesPramidSvg.width).attr("height",n.agesPramidSvg.height),c=d3.select(".populationChangeSvg").append("svg").attr("width",n.populationChangeSvg.width).attr("height",n.populationChangeSvg.height),p=i?$(".sexRatioSvg").width():.7*$(".sexRatioSvg").width(),u=o.append("rect").attr({fill:"rgb(63,169,245)",width:0,height:30,x:0,y:0}),d=o.append("rect").attr({fill:"rgb(243,71,8)",width:"0px",height:30,x:i?0:parseFloat(a[0].man.replace(/,/gi,""))/parseFloat(a[0].population.replace(/,/gi,""))*p+5,y:i?40:0});o.append("text").attr({x:i?10:parseFloat(a[0].man.replace(/,/gi,""))/parseFloat(a[0].population.replace(/,/gi,""))*p-130,y:20,id:"num-man"}).text("男生約佔 50%"),o.append("text").attr({x:i?10:p-130,y:i?60:20,id:"num-girl"}).text("女生約佔 50%");var m=function(t){return[{range:"65歲以上",block:4,allBlocks:4,value:parseFloat(t[0].sixtyFiveUp_percent)},{range:"51 ~ 64歲",block:3,allBlocks:7,value:parseFloat(t[0].fiftyOne_sixtyFour_percent)},{range:"31 ~ 50歲",block:4,allBlocks:11,value:parseFloat(t[0].thirtyOne_fifty_percent)},{range:"19 ~ 30歲",block:2,allBlocks:13,value:parseFloat(t[0].nighteen_thirty_percent)},{range:"16 ~ 18歲",block:.3,allBlocks:13.3,value:parseFloat(t[0].sixteen_eighteen_percent)},{range:"13 ~ 15歲",block:.3,allBlocks:13.6,value:parseFloat(t[0].thirteen_fifteen_percent)},{range:"6 ~ 12歲",block:1.2,allBlocks:14.8,value:parseFloat(t[0].six_twelve_percent)},{range:"0 ~ 5歲",block:1,allBlocks:15.8,value:parseFloat(t[0].zero_five_percent)}]}(a),h=parseFloat((n.agesPramidSvg.height-90)/n.agesPramidSvg.blocks),f=l.selectAll("g.pramidRow").data(m),v=i?7:10,y=f.enter().append("g").attr("class","pramidRow");y.append("rect").attr("class","pramidBar").attr("width",0).attr("height",function(t){return t.block*h}).attr("y",function(t,e){var a=t.allBlocks-t.block,r=0;return e>=1&&(r=12),e>=5&&(r=24),a*h+4*e+r}).style("fill",function(t,e){return 0===e?"#165805":e>=5?"#bbf99c":void 0}).on("mouseover",function(t,e){switch(d3.select(this).style("opacity",.5),e){case 0:$(".pramidIntroText").html("「老人不講古，後生會失譜。」<br>台南的國寶級人物，生命就象徵著文化與歷史。盡力傳頌吧～這些偉大的故事！");break;case 1:$(".pramidIntroText").html("「用知識武裝自己，去實現人生的最高價值。」<br>在人生的分水嶺中，別放棄心中那個曾經擁有夢想，天真無邪的自己。");break;case 2:$(".pramidIntroText").html("「在真正的生命裡，每一樁偉業都由信念開始，並由信念跨出第一步。」<br>現任的社會中堅，處在瞬息萬變的時代所造成的資訊衝突是很巨大的，莫怕改變，勇於嘗試，堅持下去。");break;case 3:$(".pramidIntroText").html("「命運只有自己能掌握。」<br>如果說台灣就像一灘自由自在的死水，但我們是自由自在活生生的台灣人，我們可以靠自己來改變。");break;case 4:$(".pramidIntroText").html("「享受你的青春！但也別忘記自己該有的責任。」<br>它象徵著我要對於自己，對於自己愛的人做出點什麼，因為我即將成為一個能獨立承當責任的成人，而再也不是一個處處受人照應的孩童了。");break;case 5:$(".pramidIntroText").html("「學習是學生的責任，它不是我的負擔，也不是痛苦的來源，它是自我的舞台。」<br>但別屈服於分數的權威體制下，做自己的主人翁。");break;case 6:$(".pramidIntroText").html("「保護眼睛，每天只能用30分鐘電腦或平板喔^^」<br>這麼小就用科技產品，要顧好眼睛啊！");break;case 7:$(".pramidIntroText").html("「哇嗚哇嗚啊～爸爸媽媽們辛苦了！」<br>我們假設你還看不懂中文字，所以對爸爸媽媽辛苦的幫你翻譯，說聲辛苦了！");break;default:$(".pramidIntroText").text("")}}).on("mouseleave",function(){d3.select(this).style("opacity",1),$("#pramidIntroText").text("")}),y.append("text").attr("class","label").attr("dx",".3em").attr("dy",".35em").attr("x",function(t,e){return 1===e||2===e?i?t.value*v-130:t.value*v+300:3===e?i?t.value*v-20:t.value*v+300:5===e?i?t.value*v+60:t.value*v+300:i?t.value*v+5:t.value*v+140}).attr("y",function(t,e){var a=t.allBlocks-t.block,r=0;return e>=1&&(r=12),e>=5&&(r=24),a*h+4*e+t.block*h/2+r}).text(function(t){return t.range+":  "+t.value+"%"}),y.append("path").attr("d",function(t,e){var a=t.allBlocks-t.block,r=0;e>=1&&(r=12),e>=5&&(r=24);var n=t.value*v,o=a*h+4*e+t.block*h/2+r;return 1===e||2===e||3===e?i?"":"M "+n+" "+o+", H "+(n+290):5===e?i?"M "+n+" "+o+", H "+(n+60):"M "+n+" "+o+", H "+(n+290):i?"M "+n+" "+o+", H "+(n+5):"M "+n+" "+o+", H "+(n+130)}).attr("stroke","#D7DAE1");var _=function(t){return{naturalNum:t[0].naturalIncrease_num,naturalPercent:parseFloat(t[0].naturalIncrease_percent),societyNUm:t[0].society_num,societyPercent:parseFloat(t[0].society_percent),naturalData:[{name:"出生數",value:parseFloat(t[0].born_num.replace(/,/gi,""))},{name:"死亡數",value:parseFloat(t[0].death_num.replace(/,/gi,""))}],socialData:[{name:"移入數",value:parseFloat(t[0].immigration_num.replace(/,/gi,""))},{name:"移出數",value:parseFloat(t[0].leaving_num.replace(/,/gi,""))}]}}(a),g=c.selectAll("g.populationRow").data(_.naturalData),F=[0,0],x=g.enter().append("g").attr("class","populationRow"),b=d3.max([].concat(_toConsumableArray(_.naturalData),_toConsumableArray(_.socialData)),function(t){return t.value})+2e3,A=d3.scale.linear().domain([0,b]).range([0,i?.6*$(".populationChangeSvg").width():.7*$(".populationChangeSvg").width()]);x.append("rect").attr("width",0).attr("height","30px").attr("y",function(t,e){return 40*e}).attr("x","0").attr("fill",function(t,e){return 0===e?"#FFAA0A":"#542801"}).transition().duration(1e3).delay(800).attr("width",function(t){return A(t.value)}),x.append("text").attr("x",10).attr("y",function(t,e){return 40*e+15}).attr("dy",".3em").attr("class","population-name-text").text(function(t){return t.name}),x.append("text").attr("x",15).attr("y",function(t,e){return 40*e+15}).attr("dy",".35em").attr("class","num-text").text("0").transition().duration(1e3).delay(800).tween("num-text",function(t,e){var a=d3.interpolateRound(F[e],t.value);return F[e]=t.value,function(t){this.setAttribute("x",A(a(t))+15),this.textContent=a(t)+" 人"}}),$(document).scroll(function(){var e=$(t).scrollTop();e>$("#X-element.report-section").offset().top-300&&(u.transition().duration(1500).attr("width",parseFloat(a[0].man.replace(/,/gi,""))/parseFloat(a[0].population.replace(/,/gi,""))*p),d.transition().duration(1e3).attr("width",parseFloat(a[0].girl.replace(/,/gi,""))/parseFloat(a[0].population.replace(/,/gi,""))*p)),e>$("#Y-element.report-section").offset().top-300&&(y.selectAll("rect").transition().duration(function(){return 900*(Math.random()+.3)}).attr("width",function(t){return t.value*v}),y.selectAll("path").transition().delay(500).duration(300).style("opacity",1),y.selectAll("text").transition().delay(500).duration(300).style("opacity",1))});var C=!0;$(".btn-change-population-data").click(function(){C?$(".btn-change-population-data").text("點我看 出生 / 死亡"):$(".btn-change-population-data").text("點我看 移入 / 移出"),r(_,!C),C=!C}),e=function(t){var e={},a=[].concat(_toConsumableArray(t));return s.population=a[0].population,s.density=parseFloat(a[0].density),s.man=a[0].man,s.girl=a[0].girl,s.sexRatio=parseFloat(a[0].sexRatio),s.raiseRatio=parseFloat(a[0].sexRatio),s.zero_fourteen_num=a[0].zero_fourteen_num,s.fifteen_sixtyFour_num=a[0].fifteen_sixtyFour_num,s.sixtyFiveUp_num=a[0].sixtyFiveUp_num,s.zero_fourteen_percent=parseFloat(a[0].zero_fourteen_percent),s.fifteen_sixtyFour_percent=parseFloat(a[0].fifteen_sixtyFour_percent),s.sixtyFiveUp_percent=parseFloat(a[0].sixtyFiveUp_percent),s.zero_five_percent=parseFloat(a[0].zero_five_percent),s.six_twelve_percent=parseFloat(a[0].six_twelve_percent),s.thirteen_fifteen_percent=parseFloat(a[0].thirteen_fifteen_percent),s.sixteen_eighteen_percent=parseFloat(a[0].sixteen_eighteen_percent),s.nighteen_thirty_percent=parseFloat(a[0].nighteen_thirty_percent),s.thirtyOne_fifty_percent=parseFloat(a[0].thirtyOne_fifty_percent),s.fiftyOne_sixtyFour_percent=parseFloat(a[0].fiftyOne_sixtyFour_percent),s.naturalIncrease_num=a[0].naturalIncrease_num,s.naturalIncrease_percent=parseFloat(a[0].naturalIncrease_percent),s.marry_num=a[0].marry_num,s.marry_percent=parseFloat(a[0].marry_percent),s.divorce_num=a[0].divorce_num,s.divorce_percent=parseFloat(a[0].divorce_percent),s.born_num=a[0].born_num,s.death_num=a[0].death_num,s.immigration_num=a[0].immigration_num,s.leaving_num=a[0].leaving_num,s.society_num=a[0].society_num,s.society_percent=parseFloat(a[0].society_percent),a.forEach(function(t){var a=parseFloat(t.population.replace(/,/gi,"")),r=parseFloat(t.density),n=parseFloat(t.zero_fourteen_percent),o=parseFloat(t.fifteen_sixtyFour_percent),i=parseFloat(t.sixtyFiveUp_percent),l=parseFloat(t.sexRatio),c=parseFloat(t.raiseRatio);e[t.area.replace(/\s/gi,"")]={isDensityOver:r>s.density,density:formatFloat(r,0),populationPercent:formatFloat(a/parseFloat(s.population.replace(/,/gi,""))*100,1),zeroFourteenPercent:n,fifteenSixtyFourPercent:o,sixtyFiveUpPercent:i,raiseRatio:c,sexRatio:l}}),e}(a)}),d3.json("./src/data/tainan-town.topo.json",function(t){var o=d3.geo.path().projection(d3.geo.mercator().center([120.72,23.1]).scale(35e3));a=topojson.feature(t,t.objects.tainan).features,n.selectAll("path").data(a).enter().append("path").attr({d:o,fill:function(t){var a=t.properties.TOWNNAME;return e[a].isDensityOver?r(e[a].density):"#D7DAE1"},stroke:"white","stroke-width":"1.5px"}).on("mouseover",function(t){var a=t.properties.TOWNNAME,r=e[a].density,n=e[a].sixtyFiveUpPercent;d3.select(this).style("fill-opacity",.4),$(".intro-area").html(a),$("#intro-density").html(c(r)),$("#deskMap-sex-ratio").html(e[a].sexRatio),$("#deskMap-sixtyFiveUp").html(n+" %"),$("#deskMap-fifteen-sixtyFour").html(e[a].fifteenSixtyFourPercent+" %"),$("#deskMap-zero-fourteen").html(e[a].zeroFourteenPercent+" %"),$("#deskMap-intro-num").html(function(){var t=e[a].raiseRatio,r=parseFloat(t/10);return r>4?($("#deskMap-intro-word").text("社會中的無生產能力人口比例將會越來越重..."),$("#deskMap-intro-num").addClass(" color-red p-size-big")):($("#deskMap-intro-word").text("年輕人的負擔將越變越大..."),$("#deskMap-intro-num").removeClass(" color-red p-size-big")),r}),$("#deskMap-ages-text").html(function(){var t=formatFloat(parseFloat(14-n),1);return n>20?'OMG 已經達到<span class="color-red">超高齡社會</span> 的標準了！老年人口佔人口的 20%以上了！':n>14?'已達到 <span class="color-red">高齡社會</span> 的標準！老年人口佔人口的 14%以上。':'離高齡化社會只差 <span class="color-red">'+t+" %</span>，要注意啊！"}),e[a].isDensityOver?$("#intro-density").addClass("p-size-big color-red"):$("#intro-density").removeClass("p-size-big color-red")}).on("mouseleave",function(t){d3.select(this).style("fill-opacity",1)})});var p=function(t){o.selectAll("*").remove();var r=d3.geo.path().projection(d3.geo.mercator().center([121.55,22.58]).scale(16e3));o.selectAll("path").data(a).enter().append("path").attr({d:r,fill:function(e){return e.properties.TOWNNAME===t?"#FFAA0A":"#D7DAE1"},stroke:"white","stroke-width":"1px"}),d3.select(void 0).style("fill-opacity",.4);var n=e[t].density,i=e[t].sixtyFiveUpPercent;$("#mobile-area").text(t),$("#mobile-intro-density").html("&nbsp;"+n),$(".intro-area").html(t),$("#intro-density").html(c(n)),$("#mobile-sex-ratio").html(e[t].sexRatio),$("#mobile-sixtyFiveUp").html(i+" %"),$("#mobile-fifteen-sixtyFour").html(e[t].fifteenSixtyFourPercent+" %"),$("#mobile-zero-fourteen").html(e[t].zeroFourteenPercent+" %"),$("#mobile-intro-num").html(function(){var a=e[t].raiseRatio,r=parseFloat(a/10);return r>4?($("#mobile-intro-word").text("社會中的無生產能力人口比例將會越來越重..."),$("#mobile-intro-num").addClass(" color-red p-size-big")):($("#mobile-intro-word").text("年輕人的負擔將越變越大..."),$("#mobile-intro-num").removeClass(" color-red p-size-big")),r}),$("#mobile-ages-text").html(function(){var t=formatFloat(parseFloat(14-i),1);return i>20?'OMG 已經達到<span class="color-red">超高齡社會</span> 的標準了！老年人口佔人口的 20%以上了！':i>14?'已達到 <span class="color-red">高齡社會</span> 的標準！老年人口佔人口的 14%以上。':'離高齡化社會只差 <span class="color-red">'+t+" %</span>，要注意啊！"}),e[t].isDensityOver?$("#mobile-intro-density").addClass("p-size-big color-red"):$("#mobile-intro-density").removeClass("p-size-big color-red")};$(".ui.dropdown").dropdown({onChange:function(t,e){$("#map-modal").modal({offset:$("#tainan-every-area").offset().top-200}).modal("show"),p(e)}}),t.setTimeout(function(){i?$("body").on("click",".ui.pointing.menu .item",function(){var t=$(this).data("container");$(".column.active").removeClass("active"),$(".container.active").removeClass("active"),$("."+t).addClass("active"),$(".item.active").removeClass("active"),$(this).addClass("active"),$(".right.item").hasClass("active")?$(".table-container").removeClass("disable"):$(".table-container").addClass("disable")}):$(".ui.pointing.menu .item").click(function(){var t=$(this).data("container");$("."+t).toggleClass("active"),$(this).toggleClass("active"),$(".right.item").hasClass("active")?$(".table-container").removeClass("disable"):$(".table-container").addClass("disable")})},100)}(window);