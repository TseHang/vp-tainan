"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var d3=window.d3,Vue=window.Vue,$=window.$,CountUp=window.CountUp;!function(t){var e=void 0,a=void 0,r=d3.scale.linear().domain([860,13e3]).range(["#ffb62a","#503604"]),n=d3.select(".area-desktop-map").append("svg").attr("width","100%").attr("height",$(".area-intro").height()),o=d3.select(".area-mobile-map").append("svg").attr("width","100%").attr("height",.35*$(t).height()),i={};$(t).width()<768&&$("#every-area").addClass("color-red p-font-600"),d3.csv("./src/data/population_xyz.csv",function(a){var r=(new Vue({delimiters:["${","}"],el:"#table-list",data:{dataArray:a},computed:{descendPopulation:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.population)-parseFloat(t.population)})},descendDensity:function(){var t=[].concat(_toConsumableArray(this.dataArray));return t.sort(function(t,e){return parseFloat(e.density)-parseFloat(t.density)}),[t[13]].concat(_toConsumableArray(t))},descendMan:function(){return[].concat(_toConsumableArray(this.dataArray)).sort(function(t,e){return parseFloat(e.man)-parseFloat(t.man)})}}}),{sexRatioSvg:{width:"80%",height:30},agesPramidSvg:{width:"100%",height:300,rectY:20,blocks:15.8}}),n=d3.select(".sexRatioSvg").append("svg").attr("width",r.sexRatioSvg.width).attr("height",r.sexRatioSvg.height),o=d3.select(".agesPramidSvg").append("svg").attr("width",r.agesPramidSvg.width).attr("height",r.agesPramidSvg.height),s=.7*$(".sexRatioSvg").width(),l=n.append("rect").attr({fill:"rgb(63,169,245)",width:0,height:30,x:0,y:0}),p=n.append("rect").attr({fill:"rgb(243,71,8)",width:"0px",height:30,x:a[0].man/a[0].population*s+5,y:0});n.append("text").attr({x:a[0].man/a[0].population*s-130,y:20,id:"num-man"}).text("男生約佔 50.1%"),n.append("text").attr({x:s-125,y:20,id:"num-girl"}).text("女生約佔 49.9%");var c=function(t){return{sexRatio:parseFloat(t[0].sexRatio),zero_fourteen_num:parseFloat(t[0].zero_fourteen_num),fifteen_sixtyFour_num:parseFloat(t[0].fifteen_sixtyFour_num),sixtyFiveUp_num:parseFloat(t[0].sixtyFiveUp_num),zero_fourteen_percent:parseFloat(t[0].zero_fourteen_percent),fifteen_sixtyFour_percent:parseFloat(t[0].fifteen_sixtyFour_percent),sixtyFiveUp_percent:parseFloat(t[0].sixtyFiveUp_percent),pramidData:[{range:"65歲以上",block:4,allBlocks:4,value:parseFloat(t[0].sixtyFiveUp_percent)},{range:"51 ~ 64歲",block:3,allBlocks:7,value:parseFloat(t[0].fiftyOne_sixtyFour_percent)},{range:"31 ~ 50歲",block:4,allBlocks:11,value:parseFloat(t[0].thirtyOne_fifty_percent)},{range:"19 ~ 30歲",block:2,allBlocks:13,value:parseFloat(t[0].nighteen_thirty_percent)},{range:"16 ~ 18歲",block:.3,allBlocks:13.3,value:parseFloat(t[0].sixteen_eighteen_percent)},{range:"13 ~ 15歲",block:.3,allBlocks:13.6,value:parseFloat(t[0].thirteen_fifteen_percent)},{range:"6 ~ 12歲",block:1.2,allBlocks:14.8,value:parseFloat(t[0].six_twelve_percent)},{range:"0 ~ 5歲",block:1,allBlocks:15.8,value:parseFloat(t[0].zero_five_percent)}]}}(a),d=parseFloat((r.agesPramidSvg.height-90)/r.agesPramidSvg.blocks),u=o.selectAll("g.pramidRow").data(c.pramidData),f=u.enter().append("g").attr("class","pramidRow");f.append("rect").attr("class","pramidBar").attr("width",0).attr("height",function(t){return t.block*d}).attr("y",function(t,e){var a=t.allBlocks-t.block,r=0;return e>=1&&(r=12),e>=5&&(r=24),a*d+4*e+r}).style("fill",function(t,e){return 0===e?"#165805":e>=5?"#bbf99c":void 0}),f.append("text").attr("class","label").attr("dx",".3em").attr("dy",".35em").attr("x",function(t,e){return 5===e?10*t.value+300:10*t.value+140}).attr("y",function(t,e){var a=t.allBlocks-t.block,r=0;return e>=1&&(r=12),e>=5&&(r=24),a*d+4*e+t.block*d/2+r}).text(function(t){return t.range+":  "+t.value+"%"}),f.append("path").attr("d",function(t,e){var a=t.allBlocks-t.block,r=0;e>=1&&(r=12),e>=5&&(r=24);var n=10*t.value,o=a*d+4*e+t.block*d/2+r;return 5===e?"M "+n+" "+o+", H "+(n+290):"M "+n+" "+o+", H "+(n+130)}).attr("stroke","#D7DAE1"),$(document).scroll(function(){var e=$(t).scrollTop();e>$("#X-element.report-section").offset().top-300&&(l.transition().duration(1500).attr("width",a[0].man/a[0].population*s),p.transition().duration(1e3).attr("width",a[0].girl/a[0].population*s)),e>$("#Y-element.report-section").offset().top-300&&(f.selectAll("rect").transition().duration(function(){return 900*(Math.random()+.3)}).attr("width",function(t){return 10*t.value}),f.selectAll("path").transition().delay(500).duration(300).style("opacity",1),f.selectAll("text").transition().delay(500).duration(300).style("opacity",1))}),e=function(t){var e={};return i.population=parseFloat(t[0].population),i.density=parseFloat(t[0].density),i.man=parseFloat(t[0].man),i.girl=parseFloat(t[0].girl),i.sexRatio=parseFloat(t[0].sexRatio),i.zero_fourteen_num=parseFloat(t[0].zero_fourteen_num),i.fifteen_sixtyFour_num=parseFloat(t[0].fifteen_sixtyFour_num),i.sixtyFiveUp_num=parseFloat(t[0].sixtyFiveUp_num),i.zero_fourteen_percent=parseFloat(t[0].zero_fourteen_percent),i.fifteen_sixtyFour_percent=parseFloat(t[0].fifteen_sixtyFour_percent),i.sixtyFiveUp_percent=parseFloat(t[0].sixtyFiveUp_percent),i.zero_five_percent=parseFloat(t[0].zero_five_percent),i.six_twelve_percent=parseFloat(t[0].six_twelve_percent),i.thirteen_fifteen_percent=parseFloat(t[0].thirteen_fifteen_percent),i.sixteen_eighteen_percent=parseFloat(t[0].sixteen_eighteen_percent),i.nighteen_thirty_percent=parseFloat(t[0].nighteen_thirty_percent),i.thirtyOne_fifty_percent=parseFloat(t[0].thirtyOne_fifty_percent),i.fiftyOne_sixtyFour_percent=parseFloat(t[0].fiftyOne_sixtyFour_percent),t.forEach(function(t){var a=parseFloat(t.density);e[t.area.replace(/\s/gi,"")]={isDensityOver:a>i.density,density:formatFloat(a,0)}}),e}(a)}),d3.json("./src/data/tainan-town.topo.json",function(t){var o=d3.geo.path().projection(d3.geo.mercator().center([120.72,23.1]).scale(35e3));a=topojson.feature(t,t.objects.tainan).features,n.selectAll("path").data(a).enter().append("path").attr({d:o,fill:function(t){var a=t.properties.TOWNNAME;return e[a].isDensityOver?r(e[a].density):"#D7DAE1"},stroke:"white","stroke-width":"1.5px"}).on("mouseover",function(t){var a=t.properties.TOWNNAME,r=e[a].density;d3.select(this).style({stroke:"#333","stroke-width":"6px"}),$(".intro-area").html(a),$("#intro-population-percent").html(e[a].populationPercent+"%"),$("#intro-density").html(r),e[a].isDensityOver?$("#intro-density").addClass("p-font-600 color-red"):$("#intro-density").removeClass("p-font-600 color-red")}).on("mouseleave",function(t){d3.select(this).style({stroke:"white","stroke-width":"1.5px"})})});var s=function(t){o.selectAll("*").remove();var r=d3.geo.path().projection(d3.geo.mercator().center([121.55,22.58]).scale(16e3));o.selectAll("path").data(a).enter().append("path").attr({d:r,fill:function(e){return e.properties.TOWNNAME===t?"#FFAA0A":"#D7DAE1"},stroke:"white","stroke-width":"1.5px"});var n=e[t].density;$("#mobile-area").text(t),$("#mobile-population-percent").html("&nbsp;"+e[t].populationPercent+"%&nbsp;"),$("#mobile-density").html("&nbsp;"+n+"&nbsp;"),e[t].isDensityOver?$("#mobile-density").addClass("p-font-600 color-red"):$("#mobile-density").removeClass("p-font-600 color-red")};$(".ui.dropdown").dropdown({onChange:function(t,e){$("#map-modal").modal("show"),s(e)}}),$(".ui.pointing.menu .item").click(function(){var t=$(this).data("container");$(".container.active").removeClass("active"),$("."+t).addClass("active"),$(".item.active").removeClass("active"),$(this).addClass("active")})}(window);